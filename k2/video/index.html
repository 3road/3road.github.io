<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1.0">
    <title>视频列表</title>
    <link rel="stylesheet" href="css/plyr.css">
    <style>
        /* 重置并新增布局样式 */
        body {
            background: url(https://picsum.photos/1600/900/?nature,animal,cat,rain,city,girl,starry) no-repeat center/cover fixed;
            margin: 0;
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            font-family: '微软雅黑', sans-serif;
            padding: 20px 0;
        }

        .container {
            width: 95%;
            max-width: 1200px;
            background: rgba(0,0,0,0.35);
            border-radius: 12px;
            padding: 18px;
            box-sizing: border-box;
            box-shadow: 0 6px 24px rgba(0,0,0,0.25);
        }

        .layout {
            display: flex;
            gap: 18px;
            align-items: flex-start;
        }

        /* 左侧播放器 */
        .player-panel {
            flex: 1 1 65%;
            background: rgba(255,255,255,0.02);
            border-radius: 10px;
            padding: 12px;
            box-sizing: border-box;
            min-width: 300px;
        }

        .player-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
        }

        .player-title {
            color: #fff;
            font-weight: 700;
            font-size: 18px;
        }

        .player-type {
            color: #d6d6d6;
            font-size: 13px;
            background: rgba(255,255,255,0.04);
            padding: 6px 8px;
            border-radius: 6px;
        }

        /* 彩色分割线：渐变 + 流动动画 */
        .player-divider {
            height: 6px;
            margin-bottom: 12px;
            border-radius: 6px;
            background: linear-gradient(90deg, #ff6b6b, #f8e71c, #6bffb8, #6b8bff, #d36bff);
            background-size: 300% 100%;
            box-shadow: 0 2px 8px rgba(0,0,0,0.25);
            border: 0;
            animation: rainbow-slide 6s linear infinite;
        }

        @keyframes rainbow-slide {
            0%   { background-position: 0% 50%; }
            50%  { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }

        .player-wrapper {
            width: 100%;
            background: #000;
            border-radius: 8px;
            overflow: hidden;
            display: flex;
            justify-content: center;
            align-items: center;
            position: relative;
        }

        /* 控制播放器最大尺寸，保证不会过大或过小 */
        .player-wrapper .media-element,
        .player-wrapper iframe {
            width: 100%;
            height: 100%;
            display: block;
            max-height: 60vh;
            min-height: 240px;
            box-sizing: border-box;
        }

        /* 将plyr控件的内置poster和按钮等保持样式兼容 */
        .player-wrapper .plyr {
            height: 100%;
        }

        /* 右侧播放列表 */
        .playlist {
            flex: 1 1 35%;
            max-width: 420px;
            min-width: 240px;
            overflow-y: auto;
            padding: 6px;
        }

        .section {
            background: rgba(255,255,255,0.03);
            padding: 10px;
            border-radius: 8px;
            margin-bottom: 12px;
            color: #fff;
        }

        .section-title {
            font-weight: 700;
            margin-bottom: 8px;
            font-size: 15px;
        }

        .source-list {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
        }

        .source-btn {
            background: rgba(0,0,0,0.55);
            color: #eee;
            padding: 6px 10px;
            border-radius: 16px;
            font-size: 13px;
            border: 1px solid rgba(255,255,255,0.04);
            cursor: pointer;
            transition: all .15s ease;
        }

        .source-btn:hover {
            transform: translateY(-2px);
        }

        .source-btn.active {
            background: #f5f7ff;
            color: #1a2b6e;
            border-color: rgba(64,128,255,0.9);
            box-shadow: 0 4px 12px rgba(64,128,255,0.12);
        }

        /* 使滚动条更细（视觉优化） */
        .playlist::-webkit-scrollbar { height: 6px; width: 8px; }
        .playlist::-webkit-scrollbar-thumb { background: rgba(255,255,255,0.06); border-radius: 6px; }

        @media (max-width: 900px) {
            .layout { flex-direction: column; }
            .playlist { max-width: none; width: 100%; }
            .player-panel { width: 100%; }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="layout">
            <div class="player-panel">
                <div class="player-header">
                    <div class="player-title">驾校视频</div>
                    <div id="playerType" class="player-type">Plyr</div>
                </div>
                <div class="player-divider"></div>

                <div class="player-wrapper" id="PlyrVideo">
                    <!-- 初始内容由脚本注入，保持空以便动态切换 -->
                </div>
            </div>

            <div class="playlist" id="playlist">
                <!-- 每个分组：标题 + 三个来源（缤纷、本地、zoho） -->
                <div class="section" data-section="倒车入库">
                    <div class="section-title">倒车入库</div>
                    <div class="source-list">
                        <button class="source-btn" data-type="iframe" data-src="https://workdrive.zohopublic.com.cn/embed/tfj1oeabe6b676ae047a69f93e58e0b6f268d?toolbar=false&appearance=light&themecolor=green" >zoho视源</button>
                        <button class="source-btn" data-type="plyr" data-src="" title="缤纷视源（Plyr）">缤纷视源</button>
                        <button class="source-btn" data-type="native" data-src="1.mp4" title="本地视源（原生）">本地视源</button>
                        
                    </div>
                </div>

                <div class="section" data-section="侧方停车">
                    <div class="section-title">侧方停车</div>
                    <div class="source-list">
                         <button class="source-btn" data-type="iframe" data-src="https://workdrive.zohopublic.com.cn/embed/tfj1of095cb63dd8042cdafd9e13b98bafa86?toolbar=false&appearance=light&themecolor=green" scrolling="no" frameborder="0" allowfullscreen=true width="800" height="450" title="嵌入的代码" ></iframe>zoho视源</button>
                        <button class="source-btn" data-type="plyr" data-src="">缤纷视源</button>
                        <button class="source-btn" data-type="native" data-src="2.mp4">本地视源</button>
                       
                    </div>
                </div>

                <div class="section" data-section="坡道定点停车和起步">
                    <div class="section-title">坡道定点停车和起步</div>
                    <div class="source-list">
                         <button class="source-btn" data-type="iframe" data-src="https://workdrive.zohopublic.com.cn/embed/tfj1ob43087c05de841fe812391b58b9da0dd?toolbar=false&appearance=light&themecolor=green" scrolling="no" frameborder="0" allowfullscreen=true width="800" height="450" title="嵌入的代码" ></iframe>zoho视源</button>
                        <button class="source-btn" data-type="plyr" data-src="">缤纷视源</button>
                        <button class="source-btn" data-type="native" data-src="3.mp4">本地视源</button>
                       
                    </div>
                </div>

                <div class="section" data-section="直角转弯">
                    <div class="section-title">直角转弯</div>
                    <div class="source-list">
                        <button class="source-btn" data-type="iframe" data-src="https://workdrive.zohopublic.com.cn/embed/tfj1o86a7f25b4d8644c193be416195ac6c3e?toolbar=false&appearance=light&themecolor=green" scrolling="no" frameborder="0" allowfullscreen=true width="800" height="450" title="嵌入的代码" ></iframe>zoho视源</button>
                        <button class="source-btn" data-type="plyr" data-src="">缤纷视源</button>
                        <button class="source-btn" data-type="native" data-src="4.mp4">本地视源</button>
                        
                    </div>
                </div>

                <div class="section" data-section="曲线行驶">
                    <div class="section-title">曲线行驶</div>
                    <div class="source-list">
                        <button class="source-btn" data-type="iframe" data-src="https://workdrive.zohopublic.com.cn/embed/tfj1oafd745b4a8b04c69a46f0c99ecf46b1b?toolbar=false&appearance=light&themecolor=green" scrolling="no" frameborder="0" allowfullscreen=true width="800" height="450" title="嵌入的代码" ></iframe>zoho视源</button>
                        <button class="source-btn" data-type="plyr" data-src="">缤纷视源</button>
                        <button class="source-btn" data-type="native" data-src="5.mp4">本地视源</button>
                        
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="js/plyr.min.js"></script>
    <script>
        // 全局状态
        let currentPlyr = null;
        let currentType = ''; // 'plyr' | 'native' | 'iframe'
        const wrapper = document.getElementById('PlyrVideo');
        const playerTypeEl = document.getElementById('playerType');

        // 创建并注入 Plyr 类型视频
        function createPlyr(src) {
            // 清理 wrapper
            wrapper.innerHTML = '';
            // 创建 video 元素（使用 class .media-element 使统一样式）
            const video = document.createElement('video');
            video.className = 'media-element plyr';
            video.setAttribute('playsinline', '');
            video.setAttribute('controls', '');
            video.setAttribute('preload', 'metadata');
            // 设定id以便后续通过ID绑定（如果需要）
            video.id = 'PlyrVideoElement';
            const source = document.createElement('source');
            source.src = src;
            source.type = 'video/mp4';
            video.appendChild(source);
            wrapper.appendChild(video);

            // 销毁旧的 Plyr
            if (currentPlyr) {
                try { currentPlyr.destroy(); } catch (e) {}
                currentPlyr = null;
            }

            // 初始化新的 Plyr
            currentPlyr = new Plyr(video, {
                controls: ['play', 'progress', 'current-time', 'mute', 'volume', 'captions', 'settings', 'fullscreen'],
                i18n: { speed: '速度', normal: '1X', captions: '字幕', disabled: '无' },
                autoplay: true,
                clickToPlay: true,
                // 不显示多余提示文本
                invertTime: false
            });

            // 自动播放（兼容）
            try { currentPlyr.play().catch(()=>{}); } catch(e){}
            currentType = 'Plyr';
            playerTypeEl.textContent = currentType;
        }

        // 创建并注入原生 video（不使用 Plyr）
        function createNative(src) {
            wrapper.innerHTML = '';
            // 销毁 plyr 以防残留
            if (currentPlyr) {
                try { currentPlyr.destroy(); } catch (e) {}
                currentPlyr = null;
            }

            const video = document.createElement('video');
            video.className = 'media-element';
            video.setAttribute('controls', '');
            video.setAttribute('playsinline', '');
            video.setAttribute('preload', 'metadata');
            video.id = 'NativeVideoElement';
            const source = document.createElement('source');
            source.src = src;
            source.type = 'video/mp4';
            video.appendChild(source);
            wrapper.appendChild(video);

            // 尝试自动播放（浏览器策略可能阻止）
            video.play().catch(()=>{});
            currentType = '原生';
            playerTypeEl.textContent = currentType;
        }

        // 创建并注入 iframe（外部播放器）
        function createIframe(src) {
            wrapper.innerHTML = '';
            if (currentPlyr) {
                try { currentPlyr.destroy(); } catch (e) {}
                currentPlyr = null;
            }

            const iframe = document.createElement('iframe');
            iframe.setAttribute('src', src);
            iframe.setAttribute('frameborder', '0');
            iframe.setAttribute('allowfullscreen', '');
            iframe.setAttribute('allow', 'autoplay; fullscreen');
            iframe.className = '';
            iframe.style.width = '100%';
            iframe.style.height = '60vh';
            iframe.style.minHeight = '240px';
            wrapper.appendChild(iframe);

            currentType = 'iframe';
            playerTypeEl.textContent = currentType;
        }

        // 统一切换接口（传入类型标识 plyr/native/iframe）
        function switchSource(type, src, btn) {
            // 更新各组按钮的 active 状态：只有当前被点击的按钮设置 active（但不影响其它 section）
            // 只需切换该按钮所在 .source-list 中的按钮状态
            const list = btn.closest('.source-list');
            if (list) {
                list.querySelectorAll('.source-btn').forEach(b => b.classList.remove('active'));
                btn.classList.add('active');
            }

            if (type === 'plyr') {
                createPlyr(src);
            } else if (type === 'native') {
                createNative(src);
            } else if (type === 'iframe') {
                createIframe(src);
            }
        }

        // 事件绑定（事件委托）
        document.getElementById('playlist').addEventListener('click', function(e) {
            const btn = e.target.closest('.source-btn');
            if (!btn) return;
            const type = btn.getAttribute('data-type');
            const src = btn.getAttribute('data-src');
            if (!type || !src) return;
            switchSource(type, src, btn);
        });

        // 页面加载后自动选择第一组的第一个来源（优先 Plyr）
        document.addEventListener('DOMContentLoaded', function() {
            const firstSection = document.querySelector('.section');
            if (!firstSection) return;
            const firstBtn = firstSection.querySelector('.source-btn');
            if (!firstBtn) return;
            // 将第一个按钮设为默认 active 并触发载入
            firstBtn.classList.add('active');
            const type = firstBtn.getAttribute('data-type');
            const src = firstBtn.getAttribute('data-src');
            if (type && src) {
                // 默认优先使用 Plyr（如果需要切换默认，可在此修改顺序）
                switchSource(type, src, firstBtn);
            }
        });
    </script>
</body>
</html>